<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots"
        content="noindex, nofollow, noarchive, nosnippet, noimageindex, notranslate, max-snippet:0, max-image-preview:none, max-video-preview:0" />
    <meta name="googlebot"
        content="noindex, nofollow, noarchive, nosnippet, noimageindex, notranslate, max-snippet:0, max-image-preview:none, max-video-preview:0" />
    <meta name="bingbot" content="noindex, nofollow, noarchive, nosnippet, noimageindex" />
    <title>RWA Sonar</title>
    <link rel="icon" type="image/svg+xml" href="./variant3.svg" />
    <style>
        :root {
            color-scheme: light dark;
        }

        body {
            font-family: system-ui, sans-serif;
            margin: 24px;
        }

        h1 {
            margin: 0;
        }

        .page-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 0 0 16px;
        }

        .status {
            margin: 12px 0;
            opacity: 0.8;
        }

        .table-wrap {
            overflow: auto;
            border: 1px solid #ccc;
            border-radius: 8px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            min-width: 720px;
        }

        th,
        td {
            padding: 10px 12px;
            border-bottom: 1px solid #ddd;
            text-align: left;
            vertical-align: top;
        }

        th {
            position: sticky;
            top: 0;
            background: #e5e7eb;
            color: #111827;
            transition: background 0.2s;
        }

        th:hover {
            background: #d1d5db;
        }

        th.sort-active {
            background: #c7d2fe;
            color: #1e1b4b;
        }

        @media (prefers-color-scheme: dark) {
            th {
                background: #1f2937;
                color: #f9fafb;
            }

            th:hover {
                background: #374151;
            }

            th.sort-active {
                background: #312e81;
                color: #e0e7ff;
            }

            .term-badge.ownership {
                background: #1e3a5f;
                color: #93c5fd;
            }

            .term-badge.transfers {
                background: #064e3b;
                color: #6ee7b7;
            }

            .term-badge.compliance {
                background: #78350f;
                color: #fcd34d;
            }

            .term-badge.recovery {
                background: #831843;
                color: #f9a8d4;
            }

            .term-badge.maturity {
                background: #312e81;
                color: #c7d2fe;
            }

            .term-badge.pillar {
                background: #4c1d95;
                color: #ddd6fe;
            }
        }

        .desc-clamp {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 3;
            line-clamp: 3;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: normal;
            cursor: help;
            max-width: 420px;
        }

        #descTooltip {
            position: fixed;
            z-index: 9999;
            display: none;
            max-width: min(560px, 75vw);
            max-height: 260px;
            overflow: auto;
            padding: 10px 12px;
            border: 1px solid #9ca3af;
            border-radius: 8px;
            background: #111827;
            color: #f9fafb;
            white-space: pre-wrap;
            box-shadow: 0 10px 24px rgba(0, 0, 0, 0.25);
            pointer-events: none;
        }

        .brand img {
            width: 64px;
            height: 64px;
            display: block;
        }

        .brand svg {
            width: 64px;
            height: 64px;
            display: block;
        }

        .brand .pink-dot {
            animation: pinkFade 2s ease-in-out infinite;
        }

        @keyframes pinkFade {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }

        .analysis-row {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 12px;
            margin: 0 0 8px;
        }

        .analysis-text {
            margin: 0;
            opacity: 0.9;
            line-height: 1.4;
        }

        .analysis-button {
            border: 1px solid #9ca3af;
            border-radius: 8px;
            padding: 8px 14px;
            background: transparent;
            cursor: pointer;
            font: inherit;
            white-space: nowrap;
        }

        .search-box {
            flex: 1;
            box-sizing: border-box;
            border: 1px solid #9ca3af;
            border-radius: 8px 0 0 8px;
            padding: 10px 12px;
            margin: 0 0 12px;
            font: inherit;
        }

        .search-row {
            display: flex;
            margin: 0 0 12px;
            gap: 0;
        }

        .search-row .search-box {
            width: 200px;
            flex: none;
            margin: 0;
        }

        .search-row .analysis-button {
            margin: 0;
            border-radius: 0 8px 8px 0;
            border-left: none;
            display: flex;
            align-items: center;
        }

        .maturity-pill {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.85rem;
            font-weight: 600;
            line-height: 1.2;
            border: 1px solid transparent;
            white-space: nowrap;
        }

        .maturity-pill.level-0 {
            background: #e5e7eb;
            color: #374151;
            border-color: #d1d5db;
        }

        .maturity-pill.level-1 {
            background: #fef3c7;
            color: #92400e;
            border-color: #fcd34d;
        }

        .maturity-pill.level-2 {
            background: #dcfce7;
            color: #166534;
            border-color: #86efac;
        }

        .maturity-pill.level-3 {
            background: #dbeafe;
            color: #1e40af;
            border-color: #93c5fd;
        }

        .maturity-pill.level-4 {
            background: #ede9fe;
            color: #5b21b6;
            border-color: #a78bfa;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin: 0;
        }

        .tab-button {
            border: 1px solid #9ca3af;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            padding: 8px 14px;
            background: transparent;
            cursor: pointer;
            font: inherit;
            margin-bottom: -1px;
            position: relative;
            z-index: 1;
        }

        .tab-button[aria-selected="true"] {
            border-color: #8b5cf6;
            background: Canvas;
            font-weight: 600;
            z-index: 2;
        }

        .tab-content-shell {
            border-top: 1px solid #9ca3af;
            padding-top: 12px;
        }

        .tab-panel[hidden] {
            display: none;
        }

        .vocab-layout {
            display: flex;
            flex-direction: column;
            gap: 16px;
            max-width: 720px;
            margin: 0 auto;
        }

        .vocab-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 12px;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        @media (prefers-color-scheme: dark) {
            .vocab-legend {
                background: #1f2937;
                border-color: #374151;
            }
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.85rem;
            color: #6b7280;
        }

        .problem-wrap {
            display: grid;
            grid-template-columns: minmax(220px, 360px) 1fr;
            gap: 16px;
            align-items: start;
        }

        .problem-wrap img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            border: 1px solid #ccc;
        }

        .problem-text p {
            margin: 0 0 12px;
            line-height: 1.5;
        }

        .definitions {
            margin: 0;
            padding: 0;
            list-style: none;
            display: grid;
            gap: 10px;
        }

        .definitions li {
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 10px 12px;
        }

        .definitions summary {
            cursor: pointer;
            list-style: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .definitions summary::-webkit-details-marker {
            display: none;
        }

        .definitions summary::before {
            content: "‚ñ∂";
            font-size: 0.7rem;
            transition: transform 0.2s;
            color: #6b7280;
        }

        .definitions details[open] summary::before {
            transform: rotate(90deg);
        }

        .definitions details[open]>summary {
            margin-bottom: 8px;
        }

        .definitions .term-badge {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: normal;
        }

        .term-badge.ownership {
            background: #dbeafe;
            color: #1e40af;
        }

        .term-badge.transfers {
            background: #d1fae5;
            color: #065f46;
        }

        .term-badge.compliance {
            background: #fef3c7;
            color: #92400e;
        }

        .term-badge.recovery {
            background: #fce7f3;
            color: #9d174d;
        }

        .term-badge.maturity {
            background: #e0e7ff;
            color: #3730a3;
        }

        .term-badge.pillar {
            background: #ede9fe;
            color: #5b21b6;
            font-weight: 600;
        }

        .definitions .term-content {
            padding-left: 20px;
        }

        .definitions strong {
            display: inline-block;
            margin: 0;
        }

        @media (max-width: 860px) {
            .problem-wrap {
                grid-template-columns: 1fr;
            }

            .definitions details[open] {
                margin-bottom: 8px;
            }
        }

        .definitions strong {
            display: inline-block;
            margin: 0 0 4px;
        }

        .site-footer {
            margin-top: 24px;
            padding-top: 12px;
            border-top: 1px solid #d1d5db;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 14px;
            flex-wrap: wrap;
        }

        .site-footer a {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
        }

        .site-footer a:hover {
            text-decoration: underline;
        }

        .footer-separator {
            opacity: 0.7;
        }

        .social-icon {
            font-size: 0.95em;
            line-height: 1;
        }

        .link-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .link-pill {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            padding: 2px 7px;
            border-radius: 999px;
            font-size: 0.65rem;
            font-weight: 600;
            text-decoration: none;
            white-space: nowrap;
            border: 1px solid #d1d5db;
            background: #f9fafb;
            color: #374151;
            transition: background 0.15s, border-color 0.15s;
        }

        .link-pill:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }

        .link-pill img {
            width: 12px;
            height: 12px;
            object-fit: contain;
        }

        @media (prefers-color-scheme: dark) {
            .link-pill {
                background: #1f2937;
                color: #d1d5db;
                border-color: #4b5563;
            }

            .link-pill:hover {
                background: #374151;
                border-color: #6b7280;
            }
        }

        @media (max-width: 860px) {
            .problem-wrap {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="page-header">
        <div class="brand">
            <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="44" stroke="#8b5cf6" stroke-width="2" fill="none" />
                <path d="M50 50 L85 50 A35 35 0 0 0 50 15 Z" fill="#8b5cf6" opacity="0.3" />
                <line x1="50" y1="5" x2="50" y2="95" stroke="#8b5cf6" stroke-width="1" opacity="0.3" />
                <line x1="5" y1="50" x2="95" y2="50" stroke="#8b5cf6" stroke-width="1" opacity="0.3" />
                <circle class="pink-dot" cx="70" cy="30" r="4" fill="#f472b6" />
                <text x="48" y="70" text-anchor="end" font-family="Arial, sans-serif" font-size="8" fill="#8b5cf6"
                    font-weight="bold">RWA</text>
                <text x="52" y="70" text-anchor="start" font-family="Arial, sans-serif" font-size="8" fill="#8b5cf6"
                    font-weight="bold">sonar</text>
            </svg>
        </div>
        <h1>RWA Sonar</h1>
    </div>
    <div class="tabs" role="tablist" aria-label="RWA Sonar sections">
        <button id="tab-assets" class="tab-button" role="tab" aria-selected="true" aria-controls="panel-assets"
            type="button">Assets</button>
        <button id="tab-vocabulary" class="tab-button" role="tab" aria-selected="false" aria-controls="panel-vocabulary"
            type="button">Vocabulary</button>
        <button id="tab-howto" class="tab-button" role="tab" aria-selected="false" aria-controls="panel-howto"
            type="button">How to get there...</button>
    </div>

    <div class="tab-content-shell">
        <section id="panel-assets" class="tab-panel" role="tabpanel" aria-labelledby="tab-assets">
            <div class="analysis-row">
                <p class="analysis-text">If the asset you are looking for is not present in the list below, enter its
                    blockchain address into the box below and we will attempt to fetch it and analyze its
                    characteristics
                    using AI, what else.</p>
            </div>
            <div class="search-row">
                <input id="assetSearchBox" class="search-box" type="search" placeholder="Enter blockchain address"
                    aria-label="Asset blockchain address" />
                <button type="button" class="analysis-button">Analyze</button>
            </div>
            <div id="status" class="status">Loading data...</div>
            <div class="table-wrap" id="tableWrap" hidden>
                <table id="assetsTable">
                    <thead></thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>

        <section id="panel-vocabulary" class="tab-panel" role="tabpanel" aria-labelledby="tab-vocabulary" hidden>
            <div class="vocab-layout">
                <div class="problem-wrap">
                    <img src="./iceberg2.png" alt="Iceberg metaphor for hidden RWA complexity" loading="lazy" />
                    <div class="problem-text">
                        <p>The word "tokenized" hides more than it reveals. Here we work to move away from "tokenized"
                            as a single qualifier to a more fine-grained
                            understanding of the degree of tokenization, from less to more. The most tokenized assets
                            are those where all four main pillars are present.</p>
                        <p>We strive to have all world's assets representable on blockchain as the main ledger.
                            The goal being easier tradeability and versatility and fewer disputes. But the blockchain
                            can be the main ledger only if it can be modified via a legal process. Consider owning a
                            home: if A sells it to B, but then a court returns it to A, we need mechanisms to reflect
                            that on-chain. Ownership needs to update to A even if B refuses to go online.</p>
                        <p>So we have two conflicting goals: free transfers and also the government and society
                            recognizing the transfers as legitimate. These goals are in tension.</p>
                    </div>
                </div>

                <h3 style="margin:0">The Four Pillars</h3>

                <ul class="definitions" aria-label="The four pillars">
                    <li>
                        <details open>
                            <summary>blockchainIsMainLedger<span class="term-badge pillar">pillar</span></summary>
                            <div class="term-content">Is the blockchain the primary ledger of ownership? If there is an
                                alternative authoritative ledger, such as a government land registry, then this is "no".
                                Typically "yes" for RWAs whose ownership is not centrally tracked, for example cars.
                                Typically "no" for RWAs whose ownership is centrally tracked, for example real
                                estate.</div>
                        </details>
                    </li>
                    <li>
                        <details open>
                            <summary>unconditionalTransfers<span class="term-badge pillar">pillar</span></summary>
                            <div class="term-content">Can the token be transferred freely, without requiring approval
                                from a gatekeeper (issuer, platform, or regulator)? This implies reactive compliance:
                                any compliance requirements are enforced after the transfer, not by blocking it.</div>
                        </details>
                    </li>
                    <li>
                        <details open>
                            <summary>bearerRedemption<span class="term-badge pillar">pillar</span></summary>
                            <div class="term-content">Can the token holder redeem the underlying asset from a third
                                party custodian simply by presenting (bearing) the token? This means there is no
                                vendor/issuer lock-in &mdash; the token alone is sufficient proof of the right to
                                claim the asset.</div>
                        </details>
                    </li>
                    <li>
                        <details open>
                            <summary>forcedTransfers<span class="term-badge pillar">pillar</span></summary>
                            <div class="term-content">Can tokens be moved without the holder's consent? This is
                                necessary for legal compliance and loss recovery. Tokens can be sent to unreachable
                                addresses (e.g. 0x00) but the underlying RWA is not destroyed &mdash; there must be a
                                mechanism to correct this. This also enables theft recovery, loss recovery, and
                                heritability.</div>
                        </details>
                    </li>
                </ul>

                <h3 style="margin:0">Maturity Stage</h3>
                <p style="margin:0 0 4px;line-height:1.5">An asset that has not reached a higher level is considered
                    Level 0. Each level requires all previous levels.</p>
                <ul class="definitions" aria-label="Maturity stage levels">
                    <li style="display:flex;align-items:center;gap:10px">
                        <span class="maturity-pill level-1">Level 1</span>
                        <span>blockchainIsMainLedger</span>
                    </li>
                    <li style="display:flex;align-items:center;gap:10px">
                        <span class="maturity-pill level-2">Level 2</span>
                        <span>Level 1 + unconditionalTransfers</span>
                    </li>
                    <li style="display:flex;align-items:center;gap:10px">
                        <span class="maturity-pill level-3">Level 3</span>
                        <span>Level 2 + bearerRedemption</span>
                    </li>
                    <li style="display:flex;align-items:center;gap:10px">
                        <span class="maturity-pill level-4">Level 4</span>
                        <span>Level 3 + forcedTransfers</span>
                    </li>
                </ul>

                <h3 style="margin:0">Other Properties</h3>
                <p style="margin:0 0 4px;line-height:1.5">Additional properties that describe the quality and
                    robustness of the tokenization.</p>

                <ul class="definitions" aria-label="Other vocabulary definitions">
                    <li>
                        <details>
                            <summary>titleDeed<span class="term-badge ownership">ownership</span></summary>
                            <div class="term-content">Is the ownership of the token meant to record the full ownership
                                rights and obligations for the underlying asset? This is in contrast to the token
                                representing a derived or partial right.</div>
                        </details>
                    </li>
                    <li>
                        <details>
                            <summary>assetSelfCustody<span class="term-badge ownership">ownership</span></summary>
                            <div class="term-content">Can the asset represented by the token be custodied by the owner
                                without third parties? A token could represent a tangible thing which can be in
                                possession of the owner, or something intangible which cannot be physically held.</div>
                        </details>
                    </li>
                    <li>
                        <details>
                            <summary>tokenSelfCustody<span class="term-badge ownership">ownership</span></summary>
                            <div class="term-content">Can the token holder hold the token in their own wallet without
                                relying on a third-party custodian?</div>
                        </details>
                    </li>
                    <li>
                        <details>
                            <summary>issuerIndependent<span class="term-badge maturity">maturity</span></summary>
                            <div class="term-content">If the issuer company/platform/protocol goes bankrupt or
                                disappears offline, will the token continue to function and retain its meaning?</div>
                        </details>
                    </li>
                    <li>
                        <details>
                            <summary>reflectLegalDecisions<span class="term-badge compliance">compliance</span>
                            </summary>
                            <div class="term-content">Can court decisions (e.g. reverting ownership, seizing assets) be
                                enforced on-chain? If not, the token is insufficient as a representation of
                                ownership.</div>
                        </details>
                    </li>
                    <li>
                        <details>
                            <summary>presetJurisdiction<span class="term-badge compliance">compliance</span></summary>
                            <div class="term-content">Is there a defined legal jurisdiction governing the token, so that
                                the applicable legal framework is unambiguous?</div>
                        </details>
                    </li>
                    <li>
                        <details>
                            <summary>meetingOfMinds<span class="term-badge transfers">transfers</span></summary>
                            <div class="term-content">Is the transfer considered valid on the basis of the agreement
                                between buyer and seller alone, without requiring third-party sign-off?</div>
                        </details>
                    </li>
                    <li>
                        <details>
                            <summary>thirdPartyAttestations<span class="term-badge maturity">maturity</span></summary>
                            <div class="term-content">Can independent third-party (non-issuer) attestations be attached
                                to the token, verifying the link between the token and the underlying asset?</div>
                        </details>
                    </li>
                    <li>
                        <details>
                            <summary>aiReady<span class="term-badge maturity">maturity</span></summary>
                            <div class="term-content">We consider a token AI-ready if there is no KYC in the transfer
                                loop. AI agents cannot pass humanity tests, so KYC requirements exclude them from
                                participation.</div>
                        </details>
                    </li>
                </ul>
            </div>
        </section>

        <section id="panel-howto" class="tab-panel" role="tabpanel" aria-labelledby="tab-howto" hidden>
            <div class="vocab-layout">
                <p>Admittedly, our definitions are arbitrary and our classification is opinionated. But we are also
                    biased. We
                    have built (what we believe to be the only) tool that (so we believe) allows you to tokenize RWAs
                    all
                    the way to the coveted "Level 4". Check it out: <a href="https://attestify.network" target="_blank"
                        rel="noopener noreferrer">https://attestify.network</a></p>
            </div>
        </section>
    </div>

    <footer class="site-footer" aria-label="Social links">
        <a href="https://t.me/rwasonar" target="_blank" rel="noopener noreferrer"><span class="social-icon"
                aria-hidden="true">‚úà</span><span>Telegram</span></a>
        <span class="footer-separator" aria-hidden="true">‚Ä¢</span>
        <a href="https://x.com/RWASonar" target="_blank" rel="noopener noreferrer"><span class="social-icon"
                aria-hidden="true">ùïè</span><span>Twitter/X</span></a>
    </footer>

    <div id="descTooltip" role="tooltip" aria-hidden="true"></div>

    <script>
        const PILLAR_KEYS = [
            'blockchainIsMainLedger',
            'unconditionalTransfers',
            'bearerRedemption',
            'forcedTransfers'
        ];

        const PILLAR_LABELS = {
            blockchainIsMainLedger: 'Blockchain is Main Ledger',
            unconditionalTransfers: 'Unconditional Transfers',
            bearerRedemption: 'Bearer Redemption',
            forcedTransfers: 'Forced Transfers'
        };

        const GENERAL_FIELDS = new Set([
            'name', 'ticker', 'type', 'description', 'website',
            'blockchain', 'blockchain_logo', 'asset_image',
            'contractAddress', 'tokenStandard', 'recipe',
            '_links', '_maturityStage', '_maturityScore'
        ]);

        const TABLE_COLUMNS = [
            { key: 'blockchain', label: '' },
            { key: 'asset_image', label: '' },
            { key: 'name', label: 'Name' },
            { key: 'type', label: 'Type' },
            { key: '_links', label: 'Links', computed: true },
            { key: '_maturityStage', label: 'Maturity Stage', computed: true },
            { key: '_maturityScore', label: 'Maturity Score', computed: true },
            { key: 'blockchainIsMainLedger', label: 'Blockchain is Main Ledger' },
            { key: 'unconditionalTransfers', label: 'Unconditional Transfers' },
            { key: 'bearerRedemption', label: 'Bearer Redemption' },
            { key: 'forcedTransfers', label: 'Forced Transfers' }
        ];

        let currentSort = { key: '_maturityStage', ascending: true };
        let assetsData = null;

        async function loadAssets() {
            const status = document.getElementById('status');
            const tableWrap = document.getElementById('tableWrap');
            const thead = document.querySelector('#assetsTable thead');
            const tbody = document.querySelector('#assetsTable tbody');

            try {
                const res = await fetch('./rwa-assets-db.json', { cache: 'no-store' });
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const raw = await res.json();

                const rows = Array.isArray(raw) ? raw : Array.isArray(raw?.assets) ? raw.assets : [];
                if (!rows.length) {
                    status.textContent = 'No asset records found in rwa-assets-db.json';
                    return;
                }

                assetsData = rows;

                thead.innerHTML = `<tr>${TABLE_COLUMNS.map(col =>
                    `<th style="cursor:pointer;user-select:none;" data-key="${escapeHtml(col.key)}">${escapeHtml(col.label)}<span class="sort-indicator"></span></th>`
                ).join('')}</tr>`;

                thead.querySelectorAll('th').forEach(th => {
                    th.addEventListener('click', () => sortByColumn(th.getAttribute('data-key')));
                });

                sortByColumn('_maturityStage');
                status.textContent = `Loaded ${rows.length} assets`;
                tableWrap.hidden = false;
            } catch (err) {
                status.textContent = `Failed to load rwa-assets-db.json: ${err.message}`;
            }
        }

        function sortByColumn(key) {
            if (currentSort.key === key) {
                currentSort.ascending = !currentSort.ascending;
            } else {
                currentSort.key = key;
                currentSort.ascending = true;
            }

            assetsData.sort((a, b) => {
                let aVal, bVal;
                if (key === '_maturityScore') {
                    aVal = computeMaturityScore(a);
                    bVal = computeMaturityScore(b);
                } else if (key === '_maturityStage') {
                    aVal = computeMaturityStageNum(a);
                    bVal = computeMaturityStageNum(b);
                } else {
                    aVal = a?.[key];
                    bVal = b?.[key];
                }

                if (aVal == null && bVal == null) return 0;
                if (aVal == null) return 1;
                if (bVal == null) return -1;

                const aNum = Number(aVal);
                const bNum = Number(bVal);
                if (!isNaN(aNum) && !isNaN(bNum)) {
                    return currentSort.ascending ? aNum - bNum : bNum - aNum;
                }

                const cmp = String(aVal).toLowerCase().localeCompare(String(bVal).toLowerCase());
                return currentSort.ascending ? cmp : -cmp;
            });

            renderTableBody(document.querySelector('#assetsTable tbody'));
            updateSortIndicators();
        }

        function renderTableBody(tbody) {
            tbody.innerHTML = assetsData.map(row => `<tr>${TABLE_COLUMNS.map(col => {
                if (col.key === '_maturityStage') return `<td>${formatMaturityStageCell(computeMaturityStage(row))}</td>`;
                if (col.key === '_maturityScore') return `<td>${formatMaturityScoreCell(row)}</td>`;
                if (col.key === '_links') return `<td>${formatLinksCell(row)}</td>`;
                if (col.key === 'blockchain') return `<td>${formatBlockchainCell(row)}</td>`;
                if (col.key === 'asset_image') return `<td>${formatImageCell(row)}</td>`;
                if (PILLAR_KEYS.includes(col.key)) return `<td>${formatPillarCell(row?.[col.key])}</td>`;
                if (col.key === 'name') return `<td>${formatNameCell(row)}</td>`;
                return `<td>${escapeHtml(String(row?.[col.key] ?? ''))}</td>`;
            }).join('')}</tr>`).join('');
        }

        function updateSortIndicators() {
            document.querySelectorAll('#assetsTable th').forEach(th => {
                const key = th.getAttribute('data-key');
                const indicator = th.querySelector('.sort-indicator');
                const isActive = key === currentSort.key;
                indicator.textContent = isActive
                    ? (currentSort.ascending ? ' ‚Üë' : ' ‚Üì')
                    : '';
                th.classList.toggle('sort-active', isActive);
            });
        }

        function formatBlockchainCell(row) {
            const logo = row?.blockchain_logo;
            const name = escapeHtml(row?.blockchain ?? '');
            if (logo) {
                return `<img src="${escapeHtml(logo)}" alt="${name}" title="${name}" loading="lazy" style="max-width:24px;max-height:24px;object-fit:contain;display:block" />`;
            }
            return name;
        }

        function formatImageCell(row) {
            const src = row?.asset_image;
            if (!src) return '';
            const stage = computeMaturityStageNum(row);
            const badge = stage > 0 ? `<span style="position:absolute;top:-4px;right:-4px;min-width:18px;height:18px;background:#8b5cf6;color:white;border-radius:50%;font-size:10px;font-weight:bold;display:flex;align-items:center;justify-content:center;padding:0 4px;box-shadow:0 1px 3px rgba(0,0,0,0.3)">${stage}</span>` : '';
            const wrapperStyle = 'position:relative;display:inline-block;line-height:0';
            return `<div style="${wrapperStyle}"><img src="${escapeHtml(src)}" alt="" loading="lazy" style="max-width:48px;max-height:48px;object-fit:contain;display:block" />${badge}</div>`;
        }

        function formatNameCell(row) {
            const name = escapeHtml(row?.name ?? '');
            const ticker = row?.ticker ? `<span style="opacity:0.6;font-size:0.85em;margin-left:4px">${escapeHtml(row.ticker)}</span>` : '';
            return name + ticker;
        }

        function formatLinksCell(row) {
            const pills = [];
            const website = row?.website;
            const ticker = row?.ticker;

            if (website) {
                pills.push(`<a class="link-pill" href="${escapeHtml(website)}" target="_blank" rel="noopener noreferrer" title="Issuer website">üåê Web</a>`);
            }

            if (ticker) {
                const t = encodeURIComponent(ticker);
                const tLower = ticker.toLowerCase();
                pills.push(`<a class="link-pill" href="https://www.coingecko.com/en/coins/${escapeHtml(tLower)}" target="_blank" rel="noopener noreferrer" title="CoinGecko">ü¶é CG</a>`);
                pills.push(`<a class="link-pill" href="https://defillama.com/rwa/asset/${escapeHtml(tLower)}" target="_blank" rel="noopener noreferrer" title="DefiLlama">ü¶ô DL</a>`);
                pills.push(`<a class="link-pill" href="https://app.rwa.xyz/assets/${escapeHtml(ticker)}" target="_blank" rel="noopener noreferrer" title="RWA.xyz">üìä RWA</a>`);
            }

            if (!pills.length) return '';
            return `<div class="link-pills">${pills.join('')}</div>`;
        }

        function formatPillarCell(value) {
            const yes = isYes(value);
            const no = isNo(value);
            if (yes) return '<span style="color:#22c55e;font-weight:600" title="Yes">&#x2714;</span>';
            if (no) return '<span style="color:#ef4444;font-weight:600" title="No">&#x2718;</span>';
            return '<span style="opacity:0.3" title="Unknown">‚Äî</span>';
        }

        function isYes(value) {
            return ['yes', 'y', '1', 'true'].includes(String(value ?? '').trim().toLowerCase());
        }

        function isNo(value) {
            const v = String(value ?? '').trim().toLowerCase();
            return ['no', 'n', '0', 'false'].includes(v);
        }

        function isPropertyField(key) {
            return !GENERAL_FIELDS.has(key);
        }

        function computeMaturityStageNum(row) {
            if (!row) return 0;
            if (!isYes(row.blockchainIsMainLedger)) return 0;
            if (!isYes(row.unconditionalTransfers)) return 1;
            if (!isYes(row.bearerRedemption)) return 2;
            if (!isYes(row.forcedTransfers)) return 3;
            return 4;
        }

        function computeMaturityStage(row) {
            return `Level ${computeMaturityStageNum(row)}`;
        }

        function computeMaturityScore(row) {
            if (!row || typeof row !== 'object') return 0;
            let score = 0;
            for (const [key, value] of Object.entries(row)) {
                if (!isPropertyField(key)) continue;
                if (isYes(value)) score++;
                else if (isNo(value)) score--;
            }
            return score;
        }

        function getYesNoCounts(row) {
            if (!row || typeof row !== 'object') return { yes: 0, no: 0 };
            let yes = 0, no = 0;
            for (const [key, value] of Object.entries(row)) {
                if (!isPropertyField(key)) continue;
                if (isYes(value)) yes++;
                else if (isNo(value)) no++;
            }
            return { yes, no };
        }

        function formatMaturityStageCell(stage) {
            const num = parseInt(stage.replace('Level ', ''), 10) || 0;
            const cls = `level-${Math.min(num, 4)}`;
            return `<span class="maturity-pill ${cls}">${escapeHtml(stage)}</span>`;
        }

        function formatMaturityScoreCell(row) {
            const score = computeMaturityScore(row);
            const counts = getYesNoCounts(row);
            const green = '‚ñ™'.repeat(counts.yes);
            const red = '‚ñ™'.repeat(counts.no);
            return `<div style="display:flex;align-items:center;gap:8px">
                <span style="font-weight:600">${score}</span>
                <div style="display:flex;gap:4px">
                    <span style="color:#22c55e;letter-spacing:1px">${green}</span>
                    <span style="color:#ef4444;letter-spacing:1px">${red}</span>
                </div>
            </div>`;
        }

        function escapeHtml(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function setupDescriptionTooltip() {
            const tip = document.getElementById('descTooltip');
            let active = null;

            document.addEventListener('mouseover', (e) => {
                const el = e.target.closest('.desc-clamp');
                if (!el) return;
                active = el;
                tip.textContent = el.getAttribute('data-full') || '';
                tip.style.display = 'block';
                tip.setAttribute('aria-hidden', 'false');
            });

            document.addEventListener('mousemove', (e) => {
                if (!active) return;
                tip.style.left = `${Math.min(e.clientX + 14, window.innerWidth - tip.offsetWidth - 8)}px`;
                tip.style.top = `${Math.min(e.clientY + 14, window.innerHeight - tip.offsetHeight - 8)}px`;
            });

            document.addEventListener('mouseout', (e) => {
                if (!active) return;
                if (e.relatedTarget?.closest?.('.desc-clamp') === active) return;
                active = null;
                tip.style.display = 'none';
                tip.setAttribute('aria-hidden', 'true');
            });
        }

        function setupTabs() {
            const tabAssets = document.getElementById('tab-assets');
            const tabVocabulary = document.getElementById('tab-vocabulary');
            const tabHowto = document.getElementById('tab-howto');
            const panelAssets = document.getElementById('panel-assets');
            const panelVocabulary = document.getElementById('panel-vocabulary');
            const panelHowto = document.getElementById('panel-howto');

            function setActiveTab(tab) {
                const assetsActive = tab === 'assets';
                const vocabularyActive = tab === 'vocabulary';
                const howtoActive = tab === 'howto';
                tabAssets.setAttribute('aria-selected', assetsActive ? 'true' : 'false');
                tabVocabulary.setAttribute('aria-selected', vocabularyActive ? 'true' : 'false');
                tabHowto.setAttribute('aria-selected', howtoActive ? 'true' : 'false');
                panelAssets.hidden = !assetsActive;
                panelVocabulary.hidden = !vocabularyActive;
                panelHowto.hidden = !howtoActive;
            }

            tabAssets.addEventListener('click', () => setActiveTab('assets'));
            tabVocabulary.addEventListener('click', () => setActiveTab('vocabulary'));
            tabHowto.addEventListener('click', () => setActiveTab('howto'));
        }

        loadAssets();
        setupDescriptionTooltip();
        setupTabs();
    </script>
</body>

</html>